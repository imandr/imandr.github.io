<html>

<head>
    <script src="drift.js"></script>
    <script src="canvas.js"></script>
    <script src="qexp.js"></script>
    
    <style type="text/css">
        #canvas {
            margin: 0px;
        }
    </style>
    
</head>

<body>
    
    <canvas id="canvas" style="border:1px solid #d3d3d3;"></canvas>
    <!--
        <div>
        <p>A:<span id="a"></span></p>
        <p>B:<span id="b"></span></p>
        <p>C:<span id="c"></span></p>
        <p>D:<span id="d"></span></p>
        </div>
    -->
    <script>
        
        const margin = 10;
        const w = window.innerWidth;
        const h = window.innerHeight;
        var C = new canvas("canvas", w-margin*2, h-margin*2, -3.5, -3.5, 3.5, 3.5);

        function window_resized(event)
        {
            C.resize(document.body.clientWidth-margin*2, document.body.clientHeight-margin*2);
        }
        window_resized();
        window.onresize = window_resized;

        C.clear([0,0,0], 1.0);
        //var D = new DeJong(-1.24, 1.43, -1.65, -1.43);
        
        var D1 = new QubicExp();
        var D2 = new QubicExp();
        
        var M1 = D1.Morpher;
        var M2 = D2.Morpher;
        var SM = new Morpher([0.01], [0.99]);
        
        //var D = new DeJong(0,0,0,0);
        const NP = 30000;
        const Skip = 10;
        var points1 = D1.init_points(NP);
        var points2 = D2.init_points(NP);
        var Colors1 = new ColorChanger();
        var Colors2 = new ColorChanger();

        for( var t = 0; t < Skip; t++ )
        {
            points1 = D1.f(points1);
            points2 = D2.f(points2);
        }
        
        const dt = 0.01;
        const beta = 0.05;
        
        function step()
        {
            var c1 = Colors1.next_color();
            var c2 = Colors2.next_color();
            var params1 = M1.step(dt); 
            var params2 = M2.step(dt); 
            var p1 = [];
            var p2 = [];
            for( let i = 0; i < params1.length; i++ )
            {
                p1.push(params1[i]*beta + params2[i]*(1-beta));
                p2.push(params2[i]);
            }
            
            var share = SM.step(0.03)[0];
            //share = share*share;
            
            points1 = D1.f(points1, p1);
            points2 = D2.f(points2, p2);
            C.clear([0,0,0], 0.2);
            C.points(points1, c1, 0.1*share);
            C.points(points2, c2, 0.1*(1-share));
        }

        setInterval(step, 1000.0/15);
        
    </script>
</body>
</html>