<html>

<head>
    <script src="drift.js"></script>
    <script src="canvas.js"></script>
    <script src="qexp.js"></script>
    
    <style type="text/css">
        #canvas {
            margin: 0px;
        }
    </style>
    
</head>

<body>
    
    <canvas id="canvas" style="border:1px solid #d3d3d3;"></canvas>
    <!--
        <div>
        <p>A:<span id="a"></span></p>
        <p>B:<span id="b"></span></p>
        <p>C:<span id="c"></span></p>
        <p>D:<span id="d"></span></p>
        </div>
    -->
    <script>
        
        const margin = 10;
        const w = window.innerWidth;
        const h = window.innerHeight;
        var C = new canvas("canvas", w-margin*2, h-margin*2, -3.5, -3.5, 3.5, 3.5);

        function window_resized(event)
        {
            C.resize(document.body.clientWidth-margin*2, document.body.clientHeight-margin*2);
        }
        window_resized();
        window.onresize = window_resized;

        C.clear([0,0,0], 1.0);
        //var D = new DeJong(-1.24, 1.43, -1.65, -1.43);
        var D = new QubicExp();
        //var D = new DeJong(0,0,0,0);
        const NP = 20000;
        const Skip = 10;
        var points = D.init_points(NP);
        var Colors = new ColorChanger();

        for( var t = 0; t < Skip; t++ )
            points = D.f(points);

        function kick(points, n, t)
        {
            var inx = [];
            var i;
            for( i = 0; i < n; i++ )
                inx.push(Math.floor(Math.random()*points.length-i));

            for( i of inx )
                points.splice(i, 1);
            
            var new_points = D.init_points(n);
            for( ; t > 0; --t )
                new_points = D.f(new_points);
            
            return points.concat(new_points);
        }
        
        function step()
        {
            var c = Colors.next_color();
            D.morph(); 
            points = D.f(points);
            if( Math.random() < 0.0 )   
            {
                points = D.f(points);
                if( Math.random() < 0.5 )   points = D.f(points);
            }
             //points = D.f(points);
            //points = D.f(points);
            C.clear([0,0,0], 0.2);
            C.points(points, c, 0.2);
            
            //document.getElementById("a").innerHTML = ""+D.A;
            //document.getElementById("b").innerHTML = ""+D.B;
            //document.getElementById("c").innerHTML = ""+D.C;
            //document.getElementById("d").innerHTML = ""+D.D;

            points = kick(points, Math.floor(NP*0.05), 5);
        }

        setInterval(step, 1000.0/15);
        
    </script>
</body>
</html>