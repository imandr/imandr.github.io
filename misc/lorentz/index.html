<html>

<head>
    <script src="canvas.js"></script>
    <script src="lorentz.js"></script>
    <script src="tools.js"></script>
    
</head>

<body>
    
    <canvas id="canvas" style="border:1px solid #d3d3d3;"></canvas>
    
    <script>
        
        function color_changer()
        {
            this.H = 0.2;
            this.DH = 0.0;
            this.Momentum = 0.9;
            this.S = this.SMin = 0.3;
            this.SMax = 0.99;
            this.DS = 0.0;
            this.V = 0.99;
            
            this.next_color = function()
            {
                var d = Math.random()*0.01-0.002;
                d = this.DH * this.Momentum + d * (1.0 - this.Momentum);
                if( d < -0.1 )  d = -0.1;
                if( d > 0.1 ) d = 0.1;
                var h = this.H + d;
                this.DH = d;
                while( h >= 1.0 )
                    h -= 1.0;
                while( h < 0.0 )
                    h += 1.0;
                this.H = h;
                
                d = Math.random()*0.1-0.05;
                d = this.DS * this.Momentum + d * (1.0 - this.Momentum);
                if( d < -0.2 )  d = -0.2;
                if( d > 0.2 ) d = 0.2;
                var s = this.S + d;
                if( s > this.SMax ) s = this.SMax;
                if( s < this.SMin ) s = this.SMin;
                this.DS = s - this.S;
                this.S = s;                
                
                return hsb_to_rgb([h, s, this.V]);
            }
        }
        
        const w = window.innerWidth;
        const h = window.innerHeight;

        var Morph = new Lorentz();
		const bounds = Morph.bounds;
		const b1 = bounds[0];
		const b2 = bounds[1];
		
        var C = new canvas("canvas", w, h, b1[0], b1[1], b2[0], b2[1]);

        function window_resized(event)
        {
            C.resize(document.body.clientWidth, document.body.clientHeight);
        }
        
        window.onresize = window_resized;

        C.clear([0,0,0], 1.0);
        const NP = Morph.NPoints;
        const Skip = 50;
        var Colors = new color_changer();

        function step()
        {
			var points = Morph.init();
            var c = Colors.next_color();
			
            Morph.mutate(); 
						
            points = Morph.transform(points);
			const projected = Morph.project(points);
            //points = D.f(points);
            //points = D.f(points);
            C.clear([0,0,0], 0.8);
            C.points(projected, c, 0.07);           
        }

        setInterval(step, 1000.0/20);
        
    </script>
</body>
</html>